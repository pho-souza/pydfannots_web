<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <style>
      {% include 'css/template_css.css' %}
    </style>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
</head>
<body>
<pre>
{%- macro color_type(color) %}
{%- if color == "Green" %}
<table class='callout_questao'>
<tr><th>
  <p class='font_questao'>Questão</p>
</th></tr>
<tr><td>

{%- elif color == 'Orange' %}
<table class='callout_exemplo'>
<tr><th>
  <p class='font_exemplo'>Exemplo</p>
</th></tr>
<tr><td>

{%- elif color == 'Red' %}
<table class='callout_atencao'>
<tr><th>
  <p class='font_atencao'>Atenção</p>
</th></tr>
<tr><td>

{%- endif -%}
{%- endmacro %}
{%- set anterior = namespace('') %}
{%- set anterior.content = highlights[0].content %}
{%- set texto = '' %}
</pre>
<article>
{%- for annot  in highlights %}
  {% if annot.type in ['Square','Ink'] %}
    {% if annot.has_img %}
        {% set texto = texto + '<img src="' + annot.img_path+ '" alt="Imagem da anotação"/>' %}
    {% endif %}
    {% if annot.content %}
        {% set texto = texto + '<figcaption>' + annot.content + '</figcaption>' %}
    {% endif %}
    {{ texto }}
  {% elif annot.color_name == 'Cyan' %}
    {% if annot.text %}
        {% if annot.content.upper() == "#H1" or  annot.content.upper() == "H1"%}
            {% set texto = texto + '<h1>' + annot.text + '</h1>' %}
        {% elif annot.content.upper() == "#H2" or  annot.content.upper() == "H2" %}
            {% set texto = texto + '<h2>' + annot.text + '</h2>' %} 
        {% elif annot.content.upper() == "#H3" or  annot.content.upper() == "H3" %}
            {% set texto = texto + '<h3>' + annot.text + '</h3>' %} 
        {% elif annot.content.upper() == "#H4" or  annot.content.upper() == "H4" %}
            {% set texto = texto + '<h4>' + annot.text + '</h4>' %} 
        {% else %}
            {% set texto = texto + '<h1>' + annot.text + '</h1>' %} 
        {% endif %}
    {% elif annot.content %}
        {% set texto = texto + '<h1>' + annot.content + '</h1>' %} 
    {% endif %}
  {% elif annot.color_name == 'Yellow' %}
    {% if annot.content == '-' %}
    {% set texto = texto + '<p><ul><li>' + annot.text + '</li></ul></p>' %}
    
    {% elif annot.content == '+' and anterior.content == '+' %}
        {% set texto = texto + '<p> ' + annot.text %}
    {% elif anterior.content == '+' %}
      {% if annot.content and annot.content != "+" %}
        {% set texto = texto + ' ' + annot.text + '<ul><li>'+ annot.content +'</li></ul></p>' %}
      {% else %}
      {% set texto = texto + '<p> ' + annot.text + '</p>' %}
      {% endif %}
    {% elif annot.content == '+' -%}
        {% set texto = texto + '<p>' + annot.text %}
    {% elif annot.content and annot.text -%}
        {% set texto = texto + '<p>' + annot.text %}
        {% set texto = texto + '<ul><li>' + annot.content + '</li></ul></p>' %}
        {% elif annot.content and not annot.text -%}
        {% set texto = texto + '<p><ul><li>' + annot.content + '</li></ul></p>' %}
    {% endif %}
    {# Casos de callout #}
  {% else %}
    {%- if annot.content == '+' and anterior.content == '+' -%}
        {% set texto = texto + ' ' + annot.text + ' ' %}
    {%- elif anterior.content == '+' -%}
        {% set texto = texto + ' ' + annot.text + ' ' %}
        {% if annot.content and annot.content != "+" %}
            {% set texto = texto + '</p>' %}
            {% set texto = texto + '<hr>' %}
            {% set texto = texto + '<p><ul><li>' + annot.content + '</li></ul></p>' %}
            {% set texto = texto + '</td></tr>' + '\n</table>' %}
        {% endif %}
    {% elif annot.content == '+' -%}
        {% set texto = texto + color_type(annot.color_name) %}
        {% set texto = texto + '<p>' + annot.text + ' ' %}
    {%- elif annot.content %}
        {% set texto = texto + color_type(annot.color_name) %}
        {% set texto = texto + '<p>' + annot.text + '</p>' %}
        {% set texto = texto + '<hr>' %}
        {% set texto = texto + '<p><ul><li>' + annot.content + '</li></ul></p>' %}
        {% set texto = texto + '</td></tr>' + '\n</table>' %}
    {% else %}
        {% set texto = texto + color_type(annot.color_name) %}
        {% set texto = texto + '<p>' + annot.text + '<p>' %}
        {%- if annot.content -%}
            {% set texto = texto + '<ul><li>' + annot.content + '</li><ul>' %}
        {% endif %}
        {% set texto = texto + '</td></tr>' + '\n</table>' %}
    {%- endif -%}
  {% endif %}
  {%- if annot.content %}
  {%- set anterior.content = annot.content -%}
  {%- else -%}
  {%- set anterior.content = '' -%}
  {% endif -%}
  {{ texto }}
{% endfor -%}
</article>

</body>
</html>
